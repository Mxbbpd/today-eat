<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>วันนี้กินอะไรดี?</title>
  <style>
    body {
      background-color: #0a0f2c;
      color: white;
      font-family: sans-serif;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { color: #4fc3f7; margin-bottom: 1rem; }
    input, select, button {
      margin: 0.5rem;
      padding: 0.5rem;
      border-radius: 5px;
      font-size: 1rem;
    }
    .hidden { display: none; }
    .ingredient-inputs .suggestion-box { position: relative; margin-bottom: 1rem; }
    .suggestions {
      position: absolute;
      background: #263238;
      width: 100%;
      border-radius: 0 0 5px 5px;
      z-index: 1;
    }
    .suggestions div {
      padding: 0.4rem;
      cursor: pointer;
    }
    .suggestions div:hover { background: #37474f; }
    .random-box {
      background: #1a237e;
      margin-top: 1rem;
      padding: 1rem;
      color: #ffeb3b;
      border-radius: 10px;
      animation: shake 0.5s;
      min-width: 280px;
      text-align: center;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }
  </style>
</head>
<body>
  <h1>วันนี้กินอะไรดี?</h1>

  <label for="method">เลือกวิธีหาอาหาร:</label>
  <select id="method">
    <option value="">-- เลือก --</option>
    <option value="cook">ทำกินเอง</option>
    <option value="buy">ซื้อกิน</option>
    <option value="random">Random</option>
  </select>

  <div id="ingredient-section" class="hidden">
    <p>ใส่วัตถุดิบที่มี:</p>
    <div class="ingredient-inputs" id="ingredient-inputs"></div>
    <button onclick="addIngredientInput()">+ เพิ่มวัตถุดิบ</button>
  </div>

  <div id="foodtype-section" class="hidden">
    <p>เลือกประเภทอาหาร:</p>
    <select id="food-type">
      <option value="">-- เลือกประเภทอาหาร --</option>
      <option value="thai">อาหารไทย</option>
      <option value="japanese">อาหารญี่ปุ่น</option>
      <option value="fastfood">ฟาสต์ฟู้ด</option>
    </select>
  </div>

  <button onclick="findFood()">สุ่มอาหาร!</button>
  <div id="result" class="random-box hidden">
    <div id="recipe-text"></div>
    <div id="recipe-category"></div>
  </div>

  <script>
    const methodSelect = document.getElementById('method');
    const ingredientSection = document.getElementById('ingredient-section');
    const foodtypeSection = document.getElementById('foodtype-section');
    const resultBox = document.getElementById('result');
    const ingredientInputs = document.getElementById('ingredient-inputs');

    const recipeDatabase = [
      { name: 'หมูทอดกระเทียม', ingredients: ['หมู', 'กระเทียม', 'น้ำปลา'], category: 'ทอด' },
      { name: 'ลาบหมู', ingredients: ['หมูสับ', 'ข้าวคั่ว', 'พริกป่น'], category: 'ยำ' },
      { name: 'ต้มข่าไก่', ingredients: ['ไก่', 'ข่า', 'ตะไคร้', 'กะทิ'], category: 'ต้ม' },
      { name: 'หมูกรอบคะน้าน้ำมันหอย', ingredients: ['หมูสามชั้น', 'คะน้า', 'ซอสหอยนางรม'], category: 'ผัด' },
      { name: 'ข้าวหน้าปลาแซลมอน', ingredients: ['ปลาแซลมอน', 'ข้าว', 'ซอสเทอริยากิ'], category: 'อาหารญี่ปุ่น' },
      { name: 'สเต๊กปลาแซลมอน', ingredients: ['ปลาแซลมอน', 'น้ำมันมะกอก', 'เกลือ'], category: 'อาหารญี่ปุ่น' },
      { name: 'ไก่อบซอส', ingredients: ['ไก่', 'ซอสหอยนางรม', 'พริกไทย'], category: 'ฟาสต์ฟู้ด' },
      { name: 'หมูกระเทียมไข่ดาว', ingredients: ['หมู', 'กระเทียม', 'ไข่'], category: 'ฟาสต์ฟู้ด' }
    ];

    function addIngredientInput(value = '') {
      const wrapper = document.createElement('div');
      wrapper.className = 'suggestion-box';
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'วัตถุดิบ';
      input.value = value;
      input.oninput = () => suggestIngredients(input);
      const suggBox = document.createElement('div');
      suggBox.className = 'suggestions';
      wrapper.appendChild(input);
      wrapper.appendChild(suggBox);
      ingredientInputs.appendChild(wrapper);
    }

    function suggestIngredients(input) {
      const wrapper = input.parentElement;
      const suggBox = wrapper.querySelector('.suggestions');
      const value = input.value.toLowerCase();
      suggBox.innerHTML = '';
      if (!value) return;
      const matches = ['หมู', 'ไก่', 'ปลาแซลมอน', 'ปลาดอลลี่', 'ซีอิ๊วขาว', 'กระเทียม', 'เกลือ', 'น้ำมันมะกอก', 'พริก', 'หอมแดง', 'มะนาว', 'ต้นหอม', 'ข่า', 'ตะไคร้', 'ฟักทอง', 'กะทิ', 'ไข่', 'ขิง', 'ข้าว', 'พริกไทย', 'ผักกาดขาว', 'ไข่เค็ม', 'ถั่วฝักยาว', 'แป้งทอด', 'น้ำปลา', 'พริกแกงแดง', 'ซอสหอยนางรม'].filter(item => item.toLowerCase().includes(value));
      matches.forEach(match => {
        const div = document.createElement('div');
        div.textContent = match;
        div.onclick = () => { input.value = match; suggBox.innerHTML = ''; };
        suggBox.appendChild(div);
      });
    }

    methodSelect.onchange = () => {
      const method = methodSelect.value;
      ingredientSection.classList.toggle('hidden', method !== 'cook');
      foodtypeSection.classList.toggle('hidden', method !== 'buy');
    }

    function findFood() {
      const method = methodSelect.value;
      const ingredients = Array.from(document.querySelectorAll('#ingredient-inputs input'))
        .map(i => i.value.trim()).filter(Boolean);
      localStorage.setItem('ingredients', JSON.stringify(ingredients));

      let selected = null;
      let choice = '';

      if (method === 'cook') {
        const scoredRecipes = recipeDatabase.map(r => {
          const matched = r.ingredients.filter(i => ingredients.some(input => i.includes(input) || input.includes(i))).length;
          return { ...r, score: matched / r.ingredients.length };
        }).filter(r => r.score >= 0.5);

        if (scoredRecipes.length > 0) {
          const bestMatches = scoredRecipes.filter(r => r.score === Math.max(...scoredRecipes.map(m => m.score)));
          selected = bestMatches[Math.floor(Math.random() * bestMatches.length)];
          const percent = Math.round(selected.score * 100);
          choice = `ทำเมนู: ${selected.name} (ความแม่นยำ ${percent}%)`;
        } else {
          choice = 'ยังไม่มีเมนูที่ใกล้เคียงกับวัตถุดิบนี้ ลองเปลี่ยนดูนะ';
        }
      } else if (method === 'random') {
        selected = recipeDatabase[Math.floor(Math.random() * recipeDatabase.length)];
        choice = `เมนูสุ่ม: ${selected.name}`;
      } else if (method === 'buy') {
        const foodType = document.getElementById('food-type').value;
        const typeMap = {
          thai: ['หมูทอดกระเทียม', 'ลาบหมู', 'ต้มข่าไก่', 'หมูกรอบคะน้าน้ำมันหอย'],
          japanese: ['ข้าวหน้าปลาแซลมอน', 'สเต๊กปลาแซลมอน'],
          fastfood: ['ไก่อบซอส', 'หมูกระเทียมไข่ดาว']
        };
        const typeRecipes = typeMap[foodType] || [];
        if (typeRecipes.length > 0) {
          const matched = recipeDatabase.filter(r => typeRecipes.includes(r.name));
          selected = matched[Math.floor(Math.random() * matched.length)];
          choice = `เมนูจากประเภท ${foodType === 'thai' ? 'อาหารไทย' : foodType === 'japanese' ? 'อาหารญี่ปุ่น' : 'ฟาสต์ฟู้ด'}: ${selected.name}`;
        } else {
          choice = 'กรุณาเลือกประเภทอาหารก่อน';
        }
      } else {
        choice = 'กรุณาเลือกวิธีการหาก่อน';
      }

      document.getElementById('recipe-text').innerHTML = `<strong>${choice}</strong>`;
      document.getElementById('recipe-category').innerHTML = selected?.category ? `<p style='color: #90caf9;'>หมวดหมู่: ${selected.category}</p>` : '';
      document.getElementById('level-up-sound').play();
      resultBox.classList.remove('hidden');
    }

    window.onload = () => {
      const saved = localStorage.getItem('ingredients');
      if (saved) {
        JSON.parse(saved).forEach(v => addIngredientInput(v));
      } else {
        addIngredientInput();
      }
    }
  </script>
  <audio id="level-up-sound" src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_c778ec3d62.mp3?filename=level-up-191997.mp3" preload="auto"></audio>
</body>
</html>
